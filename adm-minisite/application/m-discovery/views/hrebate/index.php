<head>
	<title>您有一个红包待领取</title>
	<link rel="stylesheet" type="text/css" href="/resource/css/discovery/hrShare.css?v=1.2">
	<script type="text/javascript">
		if (/MicroMessenger/ig.test(navigator.userAgent) && !/code=/ig.test(window.location.href)) {
			let url = window.location.href;
			url = url.replace('discovery.gomeplus.com', 'discovery.gome.com.cn');
			url = encodeURIComponent(url);
			var redUrl = 'https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx77edddc93a91176f&redirect_uri=' + url + '&response_type=code&scope=snsapi_base&state=1234#wechat_redirect';
			window.location.href = redUrl;
		}
	</script>
</head>
<body>
	<script type="text/javascript">
		(function(win){var doc=win.document,html=doc.documentElement,option=html.getAttribute("data-use-rem");if(option===null){return}var baseWidth=parseInt(option).toString()==="NaN"?640:parseInt(option);var grids=baseWidth/100;var clientWidth=html.clientWidth||320;var fontsize=html.style.fontSize=clientWidth/grids+"px";fontsize=parseFloat(fontsize);var maxFontsize=Math.ceil(fontsize);var minFontsize=Math.floor(fontsize);var testDom=document.createElement("div");var testDomWidth=0;var adjustRatio=0;testDom.style.cssText="height:0;width:1rem;";doc.body.appendChild(testDom);var calcTestDom=function(){testDomWidth=testDom.offsetWidth;if(/iPhone|Android|MicroMessenger|gomeplus|QQ/g.test(navigator.userAgent)){if(testDomWidth<minFontsize||testDomWidth>maxFontsize){adjustRatio=clientWidth/grids/testDomWidth;var reCalcRem=clientWidth*adjustRatio/grids;html.style.fontSize=reCalcRem+"px"}else{doc.body.removeChild(testDom)}}else{html.style.fontSize="50px";document.body.style.width="375px";document.body.style.margin="0 auto";doc.body.removeChild(testDom)}};setTimeout(calcTestDom,20);var reCalc=function(){var newCW=html.clientWidth;if(newCW===clientWidth){return}clientWidth=newCW;if(/iPhone|Android|MicroMessenger|gomeplus|QQ/g.test(navigator.userAgent)){html.style.fontSize=newCW*(adjustRatio?adjustRatio:1)/grids+"px"}else{html.style.fontSize="50px";document.body.style.width="375px";document.body.style.margin="0 auto"}};if(!doc.addEventListener){return}var resizeEvt="orientationchange" in win?"orientationchange":"resize";win.addEventListener(resizeEvt,reCalc,false);doc.addEventListener("DOMContentLoaded",reCalc,false)})(window);
	</script>
	<div class="cover-common">
		<div class="share-wap-con">
			<p class="title first"></p>
			<div class="btn">
				<a class="cancel" href="javascript:">知道了</a>
				<a class="down-load-link down-link" href="javascript:void(0)">知道了</a>
			</div>
		</div>
	</div>
	<div class="con-one">
		<div class="con-content">
			<div class="con-icon"><img src="/resource/images/h_mmb_icon.png"></div>
			<div class="con-text"><img src="/resource/images/h_top.png"></div>
		</div>
		<div class="bottom">
			<div class="e-input">
				<input id="JS_mobile" type="" name="" placeholder="请输入手机号">
			</div>
			<div id="JS_submit" class="e-btn"></div>
			<div class="e-check">
				<span id="JS_check" class="check-item actived">我已阅读并同意本次</span><a class="rule-link" href="javascript:void(0)">《活动规则》</a>
			</div>
			<div class="e-slogan"></div>
		</div>
	</div>
	<div class="con-out">
		<div class="content">
			<a class="app_down_link" href="http://sj.qq.com/myapp/detail.htm?apkName=com.gome.mx.MMBoard"><div class="btn"></div></a>
		</div>
	</div>
	<div class="con-in">
		<div class="con-content">
			<div class="con-icon"><img src="/resource/images/h_mmb_icon.png"></div>
			<div class="con-text"><img src="/resource/images/h_top.png"></div>
		</div>
		<div class="bottom">
			<p class="text">红包已放入美媒榜APP账户</p>
			<div class="qr-code">
				<img src="http://meimeibang.gome.com.cn/image/qrCode.png">
			</div>
			<p class="sub-text">扫码下载，登录查看</p>
			<div class="e-slogan"></div>
		</div>
	</div>
	<div class="con-rule">
		<div class="rule-text">
			<p class="title">美媒榜红包的领取规则<em class="icon icon-close"></em></p>
			<div class="msg-con">
				<p class="msg">活动期间，美媒榜App新用户在页面输入手机号即可获得领取美媒榜红包的机会，在美媒榜APP内将活动页面分享给好友打开后，即获得红包。红包现金将通过美媒榜“分享赚”的形式送达，以国美币的形式进入您的美媒榜账户， 1国美币=1元人民币。每个新用户限领1次。单日奖池金额有限，先到先得。</p>
				<p class="sub-title">美媒榜红包如何提现？</p>
				<p class="msg">领取成功后，请到“国美APP”的【我的-返利金额】中查看，点击数字可看到【提现】按钮。（美媒榜提现功能即将上线，请暂时使用国美APP进行提现，国美币提现需满10元。）</p>
				<p class="sub-title">其他注意事项</p>
				<p class="msg">同一个用户仅限领取1份新人红包（同一个账号、同一个手机号、同一个设备号均算作同一个用户）；如发现任何违规套取新人红包行为，将视情节严重程度进行判罚：不予发放奖励、冻结账户及获得的所有返利、依法追究其法律责任。您用于领取红包的手机号将被我们登记为注册会员，美媒榜会通过短信、邮件或电话等形式向您通知最新活动。</p>
				<p class="msg">其他问题，请关注美媒榜官方微信服务号【美媒榜】，私信您的问题，即有客服回复。</p>
				<p class="msg">美媒榜拥有对本次活动的依法解释权。</p>
			</div>
		</div>
	</div>
	<script type="text/javascript" src="/resource/scripts/discovery/zepto.min.js"></script>
	<script src="/resource/scripts/discovery/crypto-js.min.js"></script>
	<script type="text/javascript" src="/resource/scripts/discovery/utils.js"></script>
	<script type="text/javascript">
		var localStorageKey = 'MMB_High_Rebate';
		var mobileEl = document.getElementById('JS_mobile');
		var submitBtn = document.getElementById('JS_submit');
		var checkEl = document.getElementById('JS_check');
		var toastEl = document.getElementById('JS_toast');
		var toastTextEl = document.getElementById('JS_text_toast');
		var isJoin = localStorage.getItem(localStorageKey);
		if (isJoin) {
			showResult();
		}
		checkEl.addEventListener('click', function() {
			if (checkEl.className.indexOf('actived') > -1) {
				checkEl.className = 'check-item normal';
			} else {
				checkEl.className = 'check-item actived';
			}
		});
		submitBtn.addEventListener('click', function() {
			impBtnClick(1);
			var mobile = mobileEl.value;
			if (mobile == '') {
				showToast('请输入手机号');
			} else if (!/^1[34578]\d{9}$/g.test(mobile)) {
				//手机号输入错误
				showToast('输入正确的手机号，即可领取红包');
			} else {
				if (checkEl.className.indexOf('actived') > -1) {
					var urlParams = utils.commonParams();
					var data = {
						mobile: mobile
					};
					if (urlParams['chl']) {
						data.channel = urlParams['chl'];
					} else {
						data.channel = 2;
					}
					$.ajax({
						url: '/api/addMobile',
						type: 'get',
						dataType: 'json',
						data: data,
						success: function(res) {
							if (res.code == 200) {
								localStorage.setItem(localStorageKey, mobile);
								showResult();
							} else if (res.code == 1001) {
								$('.cancel').css('display', 'none');
								$('.down-link').attr('href', 'javascript:void(0)').text('知道了');
								showToast('您已填写过手机号，快去领取红包吧！');
							} else if (res.code == 1002) {
								$('.cancel').css('display', 'inline-block');
								var downLink = 'http://meimeibang.gome.com.cn/mindex.html';
								if (/android/ig.test(navigator.userAgent)) {
									downLink = 'http://sj.qq.com/myapp/detail.htm?apkName=com.gome.mx.MMBoard';
								}
								$('.down-link').attr('href', downLink).text('去下载');
								showToast('您已经是老用户啦，去美媒榜赚钱吧');
							} else {
								$('.cancel').css('display', 'none');
								$('.down-link').attr('href', 'javascript:void(0)').text('知道了');
								showToast('服务器错误，请稍后重试');
							}
						}
					});
				} else {
					//没有勾选同意
					showToast('请您先同意本次《活动规则》');
				}
			}
		});
		$('.cover-common .cancel').on('click', function() {
			$('.cover-common .title').text('');
			$('.cover-common').hide();
		});
		$('.cover-common .down-link').on('click', function() {
			$('.cover-common .title').text('');
			$('.cover-common').hide();
		});
		$('.rule-link').on('click', function() {
			$('.con-rule').show();
		});
		$('.icon-close').on('click', function() {
			$('.con-rule').hide();
		})
		function showToast(text) {
			$('.cover-common .title').text(text);
			$('.cover-common').show();
		}
		function showResult() {
			if (/gomeplus|GomeBackup|GomePlus/ig.test(navigator.userAgent)) {
				$('.con-one').hide();
				$('.con-in').show();
			} else {
				$('.con-one').hide();
				$('.con-out').show();
			}
		}
		function impBtnClick(type) {
			var urlParams = utils.commonParams();
			var chl = 2;
			if (urlParams['chl']) {
				chl = urlParams['chl'];
			}
			$.ajax({
				url: '/api/yyc?type=' + type + '&chl=' + chl,
				type: 'get',
				dataType: 'json'
			});
		}
	</script>
	<script type="text/javascript">
		var downTags = document.querySelector('.app_down_link');
		var shareGuide = document.querySelector('.share_guide');
		if (/MicroMessenger/ig.test(navigator.userAgent)) {
			if (/iPhone|iPad|iPod/ig.test(navigator.userAgent)) {
				downTags.setAttribute('href', 'http://meimeibang.gome.com.cn/');
			}
		} else {
			downTags.setAttribute('href', 'http://meimeibang.gome.com.cn/');
		}
		downTags.addEventListener('click', function(e) {
			impBtnClick(2);
		});
	</script>
	<script type="text/javascript">
		function shareRebate() {
			var urlParams = utils.commonParams();
			if (urlParams['p']) {//老版本兼容
				var params = utils.getUncryptParams();
				if (params['shareId'] !== undefined) {
					params['flag'] = utils.isGome ? 1 : 0;
					if (utils.isGome) {
						var relationIdArr = decodeURIComponent(params['relationId']).split(',');
						var level = Number(relationIdArr[relationIdArr.length - 1]);
						if (relationIdArr.length === 3) {
							params['relationId'] = relationIdArr[0] + ',' + relationIdArr[1] + ',' + utils.userId + ',' + level;
						} else {
							params['relationId'] = relationIdArr[0] + ',' + utils.userId + ',' + level;
						}
					}
					var paramQ = utils.encrypt('logParam=' + params['logParam']);
					delete params['logParam'];
					var shareRebateParams = {
						p: utils.encrypt(utils.urlEncode(params).slice(1)),
						q: paramQ
					};
					$.ajax({
						url: $CONFIG['shareRebateUrl'] + '?p=' + shareRebateParams.p + '&q=' + shareRebateParams.q,
						type: 'get',
						dataType: 'jsonp',
						success: function(result) {}
					});
				}
			} else {
				if (!urlParams.s) return;
				var ajaxParams = {};
				if (utils.isWeiXin) {
					ajaxParams.o = weixin.openId;
					ajaxParams.ot = 0;
				}
				ajaxParams.s = urlParams.s;
				ajaxParams.q = urlParams.q;
				var reqData = {
					url: '/api/mm/shareRebate',
					data: ajaxParams,
					type: 'get'
				};
				if (utils.isGome) {
					reqData.headers = {
						a: utils.getHeaderA()
					}
				}
				$.ajax(reqData);
			}
		}
	</script>
	<script type="text/javascript">
		if (/MicroMessenger/ig.test(navigator.userAgent)) {
			var weixin = {
				openId: '',
				weixinConfig: [],
				weixinSDKUrl: 'https://res.wx.qq.com/open/js/jweixin-1.2.0.js',
				url: '/api/weixin',
				init: function() {
					var script = document.createElement('script');
					var parentNode = document.getElementsByTagName('head')[0] || document.body;
					script.async = true;
					script.src = weixin.weixinSDKUrl;
					script.onload = weixin.getWeixinConfigInfor;
					parentNode.appendChild(script);
				},
				getWeixinConfigInfor: function() {
					var params = utils.commonParams();
					var data = {
						shareUrl: encodeURIComponent(window.location.href.split('#')[0])
					};
					if (params['code']) {
						data['code'] = params['code'];
					}
					$.ajax({
						url: weixin.url,
						type: 'GET',
						data: data,
						dataType: 'jsonp',
						success: function(result) {
							var data = result['data'];
							weixin.openId = data['openId'] ? data['openId'] : '';
							weixin.initWeixin(data);
							shareRebate();
						}
					});
				},
				initWeixin: function(result) {
					wx.config({
						debug: false,
						appId: result['wx_appid'],
						timestamp: result['wx_timestamp'],
						nonceStr: result['wx_noncestr'],
						signature: result['wx_signature'],
						jsApiList: [
							'onMenuShareTimeline',
							'onMenuShareAppMessage',
							'onMenuShareQQ',
							'onMenuShareQZone'
						]
					});
					wx.ready(function() {
						wx.onMenuShareTimeline({
							title: '[有人@你]轻松赚钱谁不爱？',
							link: window.location.href,
							imgUrl: $CONFIG['mdomain'] + 'resource/images/highRebateShare.jpg',
						});
						wx.onMenuShareAppMessage({
							title: '[有人@你]轻松赚钱谁不爱？',
							desc: '最高领取880元红包可提现',
							link: window.location.href,
							imgUrl: $CONFIG['mdomain'] + 'resource/images/highRebateShare.jpg',
						});
					});
				}
			};
			weixin.init();
		} else {
			shareRebate();
		}
	</script>
</body>
