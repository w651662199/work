(function(e){typeof define!=="undefined"?define("utils/appInterface.js",t):t(0,{},{});function t(t,n,i){var o={},r=[],a=[],c=false,s=false,l,u=30,f="gomeplus",p="TEMPORARYEVENT";var m=e.AppInterface={notify:function(e,t){var n=o[e],i=0;if(n){var a=n.length;for(;i<a;i++){n[i].apply(this,r.slice.call(arguments,1))}}else{r.push({eventName:e,data:r.slice.call(arguments,1),scope:this})}if(new RegExp("^"+p+"(_\\d+)$").test(e))this.unsubscribe(e);return this},notifyWith:function(e,t,n){if(arguments.length<2)throw new TypeError("按作用域触发事件请提供事件名称与作用域");this.notify.apply(t,[e].concat(r.slice.call(arguments,2)))},subscribe:function(e,t){var n=0,i=r.length;if(arguments.length<2)throw new TypeError("订阅事件请提供事件名称与事件回调");var a=o[e]?o[e]:o[e]=[];a=Object.prototype.toString.call(t)==="[object Array]"?a.concat(t):a.push(t);for(;n<i;n++){if(r[n].eventName===e){this.notify.apply(r[n].scope,[e].concat(r[n].data));r.splice(n,1);break}}return this},unsubscribe:function(e,t){if(t){var n=o[e];for(var i=0;i<n.length;i++){if(n[i]===t){n.splice(i--,1)}}}else delete o[e];return this},queue:function(t){if(arguments.length==0&&!c){n();return this}if(c||!s){a.push(t);return this}c=true;t();e.setTimeout(n,u);function n(){var t=false;for(var n=0;n<a.length;n++){t=true;a[n].call();e.setTimeout(arguments.callee,u);a.splice(n,1);break}c=t}return this},delegateHyperlink:function(t){var n=this;e.setTimeout(function(){if(t){t.on("click",function(e){i(e,t)})}else{$("body").on("click","a",function(e){i(e,$(this))})}},20);function i(t,i){var o=i.attr("href");if(o&&o!="#"&&!/^javascript.*$/g.test(o)){n.queue(function(){e.location.href=o});t.preventDefault()}}return this},call:function(e){if(!this.isMobile){/debug/.test(location.search)&&console.log("非移动设备，不执行调用:"+e);return this}var t=this,n,i,o,r=0,a;if(/^\/.*$/.test(e)){e=e.slice(1)}switch(arguments.length){case 0:throw new TypeError("请至少提供一个请求地址参数");case 2:y(arguments[1])==y.Function?n=arguments[1]:y(arguments[1])==y.Number?r=arguments[1]:o=arguments[1];break;case 3:y(arguments[1])==y.Number?r=arguments[1]:o=arguments[1];y(arguments[2])==y.Function?n=arguments[2]:y(arguments[2])==y.Number?r=arguments[2]:"";break;case 4:o=arguments[1];r=arguments[2];n=arguments[3]}i=f+"://"+e;if(o){i+=(i.indexOf("?")==-1?"?":"&")+function(){var e=[],t;for(t in o){e.push(t+"="+(y(o[t])==y.Array?o[t].join("|"):o[t]))}return e.join("&")}()}if(n){a=p+"_"+(new Date).getTime();this.subscribe(a,n)}if(a){i+=(i.indexOf("?")==-1?"?":"&")+"jsCallback="+encodeURIComponent("try{window.AppInterface.notify('"+a+"',{data});}catch(e){}")}typeof ApplicationInterface!=="undefined"?function(){ApplicationInterface.call(i);/debug/.test(location.search)&&console.log((new Date).getTime()+":JsBridge:AppInterface:"+i)}():function(){t.queue(function(){/debug/.test(location.search)&&console.log((new Date).getTime()+":Url:AppInterface:"+i);v(i)})}();if(r!==0){var c=setTimeout(function(){var e=(new Date).getTime();if(!(e-parseInt(a.split("_")[1])>r+20)||!(t.isBrowser&&t.isIOS9)){t.notify(a,g(null,false,"客户端未响应"))}clearTimeout(c);c=null},r)}return this},open:function(e){this.call("/common/localJump",{url:e})},isBrowser:!/gomeplus/g.test(navigator.userAgent),isWeiXin:/MicroMessenger/g.test(navigator.userAgent),isIOS9:(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i))&&Boolean(navigator.userAgent.match(/OS [9]_\d[_\d]* like Mac OS X/i)),isMobile:/(Mobile)|(android)/gi.test(navigator.userAgent),isIOS:navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)};if(!m.isBrowser||m.isBrowser&&!m.isIOS9){s=true}else{if(document.readyState==="complete"){s=true}else{e.addEventListener("load",function(){s=true;m.queue()})}}var h={toast:function(e,t){m.call("/common/toast",{msg:e,timeout:t?t:2e3})},alert:function(e,t){m.call("/common/alert",{msg:e},t)},prompt:function(e,t,n){m.call("/common/prompt",{msg:e,content:t},n)},confirm:function(e,t){var n="提示",i,t,o=arguments;arguments.length==2?function(){i=o[0];t=o[1]}():arguments.length==3?function(){n=o[0];i=o[1];t=o[2]}():i=o[0];m.call("/common/confirm",{msg:i,title:n},t)}};var d={toast:function(e,t){var n=document.createElement("div");n.style.opacity="0";n.style.padding="7px 10px";n.style.minWidth="80px";n.style.color="#fff";n.style.textAlign="center";n.style.position="fixed";n.style.bottom="10%";n.style.left="50%";n.style.borderRadius="3px";n.style.fontSize="14px";n.style.transform="translateX(-50%)";n.style.transition="opacity .3s ease";n.style.backgroundColor="rgba(39, 39, 39, 0.6)";n.innerHTML="<p>"+e+"</p>";document.body.appendChild(n);setTimeout(function(){n.style.opacity="1"},50);setTimeout(function(){n.style.opacity="0";setTimeout(function(){document.body.removeChild(n)},300)},t?t:2e3)},alert:function(e,t){alert(e);t&&t(g({},true,""))},prompt:function(t,n,i){var n=e.prompt(t,n);i&&i(g({content:n,isCancel:n==null},true,""))},confirm:function(t,n){var i="提示",o,n,r=arguments;arguments.length==2?function(){o=r[0];n=r[1]}():arguments.length==3?function(){i=r[0];o=r[1];n=r[2]}():o=r[0];var a=e.confirm(o);n&&n(g({isCancel:!a},true,""))}};["toast","alert","prompt","confirm"].forEach(function(e){m[e]=function(){m.isBrowser?d[e].apply(null,r.slice.call(arguments)):h[e].apply(null,r.slice.call(arguments))}});function g(e,t,n){return{data:e,code:!t&1,message:n,success:t}}function y(e){var t=Object.prototype.toString.call(e);var n=t.match(/^\[object\s(.*)\]$/)[1];return y[n]||y.Object}y.Object=1;y.Array=2;y.String=3;y.Function=4;y.Number=5;function v(t,n){var i=document,o=i.body;if(m.isIOS9){e.location=t}else{if(!l){l=i.createElement("iframe");l.id="appInterfaceNativeFrame";l.style.display="none";if(!o){setTimeout(function(){i.body.appendChild(l)},0)}else{o.appendChild(l)}}l.src=t}}i.exports=m}})(window);